# MiniAppNew — Telegram Admin MiniApp (Полная документация)

**Модульная админка для Telegram на React с интеграцией n8n, поддержкой реального backend, виртуализацией сообщений и деплоем на Vercel.**

---

## Описание и назначение

MiniAppNew — это современное веб-приложение для администрирования Telegram-бота. Оно позволяет:
- Просматривать список чатов (клиентов/пользователей)
- Открывать любой чат и видеть историю сообщений
- Отправлять текстовые сообщения и файлы
- Искать по сообщениям
- Работать с реальными данными через REST API (n8n или другой backend)
- Масштабировать и дорабатывать функционал благодаря модульной архитектуре

**Проект полностью готов для деплоя на Vercel и интеграции с любым backend, поддерживающим REST API.**

---

## Архитектура и структура

```
miniappnew/
  public/           # статика, index.html, favicon, manifest
  src/
    components/     # UI-компоненты (Sidebar, Chat, Messages, MessageInput, Avatar, Layout, WebAppGuard)
    hooks/          # кастомные хуки (useMessages, useSendMessage, useSearch)
    services/       # работа с API (chatApi.js)
    lib/            # вспомогательные библиотеки (queryClient, queryKeys)
    data/           # (может быть пусто, если нет заглушек)
    App.js          # корневой компонент
    index.js        # точка входа
    index.css       # глобальные стили
    ...             # служебные файлы (reportWebVitals.js, setupTests.js и др.)
  .env              # переменные окружения (не коммитить в git)
  package.json      # зависимости и скрипты
  vercel.json       # проксирование API для Vercel
  README.md         # эта документация
  .gitignore        # исключения для git
```

---

## Основные компоненты и их назначение

- **Sidebar.jsx** — боковая панель со списком чатов (загружается с backend через `/api/chats`).
- **Chat.jsx** — область чата, отображает сообщения выбранного чата и поле ввода.
- **Messages.jsx** — виртуализированный список сообщений (react-virtuoso), поддерживает большие истории.
- **MessageInput.jsx** — поле для ввода текста и выбора файла, отправка сообщений.
- **Avatar.jsx** — аватар пользователя (инициал).
- **Layout.jsx** — компоновка интерфейса (Sidebar + Chat).
- **WebAppGuard.jsx** — проверка готовности Telegram WebApp API.

---

## Хуки и сервисы

- **useMessages** — асинхронная загрузка сообщений выбранного чата с поддержкой пагинации.
- **useSendMessage** — отправка сообщений (POST на `/api/send`).
- **useSearch** — поиск по сообщениям (GET `/api/messages?chat_id=...&search=...`).
- **chatApi.js** — все функции для работы с backend: getChats, getMessages, sendMessage.

---

## API и интеграция с backend

- Все запросы идут через проксированные эндпоинты `/api/chats`, `/api/messages`, `/api/send` (см. `vercel.json`).
- Backend может быть реализован на n8n, Supabase, Node.js, Python и т.д. — главное, чтобы поддерживал нужные эндпоинты.
- Формат ответа:
  - `/api/chats` → `{ output: [ { chat_id, first_name, ... } ] }`
  - `/api/messages?chat_id=...` → `{ output: [ { text, from, created_at, ... } ] }`
  - `/api/send` (POST) — отправка сообщения/файла

---

## Переменные окружения

В корне проекта создай файл `.env`:
```
REACT_APP_BACKEND_URL=https://pmrsolution.ru/webhook/api
```
(или другой адрес твоего backend)

---

## Быстрый старт

1. Установи зависимости:
   ```sh
   npm install
   ```
2. Запусти локально:
   ```sh
   npm start
   ```
3. Для деплоя на Vercel:
   - Подключи репозиторий к Vercel.
   - Укажи переменную окружения `REACT_APP_BACKEND_URL` в настройках Vercel.
   - Деплой произойдёт автоматически.

---

## Принципы работы и расширения

- **Модульность:** каждый компонент и хук отвечает только за свою зону ответственности.
- **Асинхронность:** все данные подгружаются через react-query, что обеспечивает кэширование и автоматическое обновление.
- **Виртуализация:** сообщения не тормозят даже при больших историях (react-virtuoso).
- **Лёгкая интеграция:** можно подключить любой backend, просто поменяв адрес API.
- **Безопасность:** переменные окружения не коммитятся, все ключи и токены хранятся вне репозитория.
- **Готовность к CI/CD:** проект легко деплоится на Vercel, поддерживает автоматические сборки.

---

## Для ассистента/агента

- **Главная задача:** обеспечить удобную и быструю работу с Telegram-чатами для админа.
- **Всё, что связано с данными — через API.**
- **Вся логика UI — в компонентах, бизнес-логика — в сервисах и хуках.**
- **Если нужно добавить новые функции (например, фильтры, массовые рассылки, статистику) — делай это через новые хуки и сервисы, не смешивая с UI.**
- **Для интеграции с n8n или другим backend — просто реализуй нужные эндпоинты, фронт не требует изменений.**
- **Вся документация и структура — в этом README.**

---

## Контакты и поддержка

- Если проект дорабатывается другим агентом/ассистентом — всегда читай этот README для понимания архитектуры и принципов работы.
- Для вопросов по API смотри `vercel.json` и `src/services/chatApi.js`.
- Для UI — смотри компоненты в `src/components/`.

---

**Проект готов к масштабированию, поддержке и интеграции с любыми внешними сервисами.** 